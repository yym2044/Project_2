<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yym.infra.modules.member.MemberMpp">

	<resultMap id="resultMapObj"
		type="com.yym.infra.modules.member.Member"></resultMap>
		
	<select id="selectListOracle" resultMap="resultMapObj">
	SELECT
		ifmmSeq
		, ifmmName
	FROM
		infrMember
	</select>	
		
	<insert id="insertMember">
	
	INSERT INTO
		infrMember (
			ifmmId
			, ifmmPwd
			, ifmmName
			<if test="ifmmDob != null and !ifmmDob.equals('')">
			, ifmmDob
			</if>
			, ifmmGenderCd
			, ifmmEmailConsentNy
			, ifmmSmsConsentNy
			, ifmmPushConsentNy
			, ifmmDelNy
			, regDateTime
			, modDateTime
		) VALUES (
			#{ifmmId}
			, #{ifmmPwd}
			, #{ifmmName}
			<if test="ifmmDob != null and !ifmmDob.equals('')">
			, #{ifmmDob}
			</if>
			, #{ifmmGenderCd}
			, #{ifmmEmailConsentNy}
			, #{ifmmSmsConsentNy}
			, #{ifmmPushConsentNy}
			, 0
			, #{regDateTime}
			, #{modDateTime}
		)
		
	<selectKey resultType="String" keyProperty="ifmmSeq" order="AFTER">
	SELECT last_insert_id()
	</selectKey>
	
	</insert>
	
	<insert id="insertMemberEmail">
	INSERT INTO
		infrMemberEmail (
			ifmmSeq
			, ifmeEmailFull
			, ifmeDefaultNy
			, ifmeDelNy
		) VALUES (
			#{ifmmSeq}
			, #{ifmeEmailFull}
			, 1
			, 0
		)
	</insert>
	
	<insert id="insertMemberPhone">
	INSERT INTO
		infrMemberPhone (
			ifmmSeq
			, ifmpNumber
			, ifmpDefaultNy
			, ifmpDelNy
		) VALUES (
			#{ifmmSeq}		
			, #{ifmpNumber}
			, 1
			, 0
		)
	</insert>
		
	<select id="selectOneLogin" resultMap="resultMapObj">
		SELECT
			ifmmSeq
			, ifmmAdminNy
			, ifmmId
			, ifmmName
			, ifmmDesc
		FROM
			infrMember
		WHERE 1=1
			AND ifmmId = #{ifmmId}
			AND ifmmPwd = #{ifmmPwd}
	</select>
	
	<select id="selectOneLoginSns" resultMap="resultMapObj">
	SELECT
		a.ifmmSeq
		, a.ifmmAdminNy
		, a.ifmmId
		, a.ifmmName
		, a.ifmmDesc
	FROM
		infrMember a
	LEFT JOIN
		infrMemberEmail b
	ON
		b.ifmmSeq = a.ifmmSeq
	WHERE 1=1
		AND b.ifmeEmailFull = #{ifmeEmailFull}
	limit 1
	</select>
	
	
	
</mapper>